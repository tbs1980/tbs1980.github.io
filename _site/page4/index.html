<!doctype html>
<!--[if lt IE 7]><html class="no-js lt-ie9 lt-ie8 lt-ie7" lang="en"> <![endif]-->
<!--[if (IE 7)&!(IEMobile)]><html class="no-js lt-ie9 lt-ie8" lang="en"><![endif]-->
<!--[if (IE 8)&!(IEMobile)]><html class="no-js lt-ie9" lang="en"><![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en"><!--<![endif]-->
<head>
<meta charset="utf-8">
<title>Latest Posts &#8211; Sreekumar Thaithara Balan's Blog</title>
<meta name="description" content="Describe this nonsense.">
<meta name="keywords" content="Jekyll, theme, themes, responsive, blog, modern">

<!-- Twitter Cards -->
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="http://tbs1980.github.io/images/abstract-1.jpg">

<meta name="twitter:title" content="Latest Posts">
<meta name="twitter:description" content="Describe this nonsense.">
<meta name="twitter:creator" content="@sreekumar_balan">

<!-- Open Graph -->
<meta property="og:locale" content="en_US">
<meta property="og:type" content="article">
<meta property="og:title" content="Latest Posts">
<meta property="og:description" content="Describe this nonsense.">
<meta property="og:url" content="http://tbs1980.github.io/page4/index.html">
<meta property="og:site_name" content="Sreekumar Thaithara Balan's Blog">





<link rel="canonical" href="http://tbs1980.github.io/page4/">
<link href="http://tbs1980.github.io/feed.xml" type="application/atom+xml" rel="alternate" title="Sreekumar Thaithara Balan's Blog Feed">

<!-- http://t.co/dKP3o1e -->
<meta name="HandheldFriendly" content="True">
<meta name="MobileOptimized" content="320">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- For all browsers -->
<link rel="stylesheet" href="http://tbs1980.github.io/assets/css/main.css">
<!-- Webfonts -->
<link href="//fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic" rel="stylesheet" type="text/css">

<meta http-equiv="cleartype" content="on">

<!-- Load Modernizr -->
<script src="http://tbs1980.github.io/assets/js/vendor/modernizr-2.6.2.custom.min.js"></script>

<!-- Icons -->
<!-- 16x16 -->
<link rel="shortcut icon" href="http://tbs1980.github.io/favicon.ico">
<!-- 32x32 -->
<link rel="shortcut icon" href="http://tbs1980.github.io/favicon.png">
<!-- 57x57 (precomposed) for iPhone 3GS, pre-2011 iPod Touch and older Android devices -->
<link rel="apple-touch-icon-precomposed" href="http://tbs1980.github.io/images/apple-touch-icon-precomposed.png">
<!-- 72x72 (precomposed) for 1st generation iPad, iPad 2 and iPad mini -->
<link rel="apple-touch-icon-precomposed" sizes="72x72" href="http://tbs1980.github.io/images/apple-touch-icon-72x72-precomposed.png">
<!-- 114x114 (precomposed) for iPhone 4, 4S, 5 and post-2011 iPod Touch -->
<link rel="apple-touch-icon-precomposed" sizes="114x114" href="http://tbs1980.github.io/images/apple-touch-icon-114x114-precomposed.png">
<!-- 144x144 (precomposed) for iPad 3rd and 4th generation -->
<link rel="apple-touch-icon-precomposed" sizes="144x144" href="http://tbs1980.github.io/images/apple-touch-icon-144x144-precomposed.png">



</head>

<body id="post-index" class="feature">

<!--[if lt IE 9]><div class="upgrade"><strong><a href="http://whatbrowser.org/">Your browser is quite old!</strong> Why not upgrade to a different browser to better enjoy this site?</a></div><![endif]-->
<nav id="dl-menu" class="dl-menuwrapper" role="navigation">
	<button class="dl-trigger">Open Menu</button>
	<ul class="dl-menu">
		<li><a href="http://tbs1980.github.io/">Home</a></li>
		<li>
			<a href="#">About</a>
			<ul class="dl-submenu">
				<li>
					<img src="http://tbs1980.github.io/images/avatarMunch.png" alt="Sreekumar Thaithara Balan photo" class="author-photo">
					<h4>Sreekumar Thaithara Balan</h4>
					<p>An astronomer who is interested in the application of novel technologies in science and in science for creating novel technology.</p>
				</li>
				<li><a href="http://tbs1980.github.io/about/"><span class="btn btn-inverse">Learn More</span></a></li>
				<li>
					<a href="mailto:sbalan@star.ucl.ac.uk"><i class="fa fa-fw fa-envelope"></i> Email</a>
				</li>
				<li>
					<a href="http://twitter.com/sreekumar_balan"><i class="fa fa-fw fa-twitter"></i> Twitter</a>
				</li>
				
				
				<li>
					<a href="http://linkedin.com/in/stbalan"><i class="fa fa-fw fa-linkedin"></i> LinkedIn</a>
				</li>
				<li>
					<a href="http://github.com/tbs1980"><i class="fa fa-fw fa-github"></i> GitHub</a>
				</li>
				
				
				
				
			</ul><!-- /.dl-submenu -->
		</li>
		<li>
			<a href="#">Posts</a>
			<ul class="dl-submenu">
				<li><a href="http://tbs1980.github.io/posts/">All Posts</a></li>
				<li><a href="http://tbs1980.github.io/tags/">All Tags</a></li>
			</ul>
		</li>
		
	    
	        
	    
	    <li><a href="http://tbs1980.github.io/publications/" >Publications</a></li>
	  
	    
	        
	    
	    <li><a href="http://tbs1980.github.io/teaching/" >Teaching</a></li>
	  
	</ul><!-- /.dl-menu -->
</nav><!-- /.dl-menuwrapper -->


<div class="entry-header">
  <div class="image-credit">Image source: <a href="http://www.dargadgetz.com/ios-7-abstract-wallpaper-pack-for-iphone-5-and-ipod-touch-retina/">dargadgetz</a></div><!-- /.image-credit -->
  
    <div class="entry-image">
      <img src="http://tbs1980.github.io/images/abstract-1.jpg" alt="Latest Posts">
    </div><!-- /.entry-image -->
  
  <div class="header-title">
    <div class="header-title-wrap">
      <h1>Sreekumar Thaithara Balan's Blog</h1>
      <h2>Latest Posts</h2>
    </div><!-- /.header-title-wrap -->
  </div><!-- /.header-title -->
</div><!-- /.entry-header -->

<div id="main" role="main">
  
<article class="hentry">
  <header>
    
      <div class="entry-image-index">
        <a href="http://tbs1980.github.io/hamiltonian-sampling/" title="Hamiltonian sampling"><img src="http://tbs1980.github.io/images/abstract-6.jpg" alt="Hamiltonian sampling"></a>
      </div><!-- /.entry-image -->
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-05-19T00:00:00+01:00"><a href="http://tbs1980.github.io/hamiltonian-sampling/">May 19, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="http://tbs1980.github.io/about/" title="About Sreekumar Thaithara Balan">Sreekumar Thaithara Balan</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://tbs1980.github.io/hamiltonian-sampling/" rel="bookmark" title="Hamiltonian sampling" itemprop="url">Hamiltonian sampling</a></h1>
    
  </header>
  <div class="entry-content">
    <p>One of the problems I am interested is the power spectrum estimation of cosmological data in the sky. Hamiltonian can be very effective here in sampling the large dimensional (~10^6) posterior probability distributions. If the posterior distribution is unimodal this technique can be very effective. I have written several codes (in C,fortran and CUDA) which can be found here. CUDA version actually outperforms CPU version as long as as one can keep all the data inside the GPU memory.</p>

<p>Here are some papers I found very useful for understanding the fundamental concepts of Hamiltonian Monte Carlo (HMC)</p>

<ol>
  <li><a href="http://arxiv.org/abs/1206.1901v1">Neal, 2011, <em>MCMC using Hamiltonian dynamics</em></a></li>
  <li><a href="http://scitation.aip.org/content/aip/proceeding/aipcp/10.1063/1.3498436">Beskos et al. 2010, <em>The Acceptance Probability of the Hybrid Monte Carlo Method in High-Dimensional Problems</em></a></li>
  <li><a href="http://doi.wiley.com/10.1111/j.1467-9868.2010.00765.x">Girolami &amp; Calderhead, 2011, <em>Riemann manifold Langevin and Hamiltonian Monte Carlo methods</em></a></li>
  <li><a href="http://link.aip.org/link/?PSI/4322/456/1&amp;Agg=doi">Hanson, 2001, <em>Markov chain Monte Carlo posterior sampling with the Hamiltonian method</em></a></li>
  <li><a href="http://arxiv.org/abs/1111.4246">Hoffman &amp; Gelman, 2014, <em>The No-U-Turn Sampler: Adaptively Setting Path Lengths in Hamiltonian Monte Carlo</em></a></li>
</ol>

<p>I started with a fortran code which can be found <a href="">here</a>, then moved to a c version called <a href="https://github.com/tbs1980/Ellipsis">Ellipsis</a> and finally created a <a href="">CUDA version</a>. For the CUDA version I get really big speed up. You can see the plots below.</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
      <div class="entry-image-index">
        <a href="http://tbs1980.github.io/numerical-optimsation/" title="Numerical optimization codes"><img src="http://tbs1980.github.io/images/abstract-7.jpg" alt="Numerical optimization codes"></a>
      </div><!-- /.entry-image -->
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-04-12T00:00:00+01:00"><a href="http://tbs1980.github.io/numerical-optimsation/">April 12, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="http://tbs1980.github.io/about/" title="About Sreekumar Thaithara Balan">Sreekumar Thaithara Balan</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~18 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://tbs1980.github.io/numerical-optimsation/" rel="bookmark" title="Numerical optimization codes" itemprop="url">Numerical optimization codes</a></h1>
    
  </header>
  <div class="entry-content">
    <p>I was looking for a code that can handle an optimization problem with a million dimension. What I know is that my function has a single peak. I can also get a fairly good starting point. There are correlations between parameters. Given these conditions, my question was what software is publicly available for solving the equations numerically. A huge list of open source minimization software can be found in <a href="https://en.wikipedia.org/wiki/List_of_optimization_software#Free_and_Open_Source_software">Wikipedia</a>. Eigen library provides a set of non-linear optimization methods. It is ported from MINPACK. Its starting point was the c version of MINPACK <a href="http://devernay.free.fr/hacks/cminpack/index.html">cminpack</a>. Then there is lfbgs++ and HLFBGS. There are routines in Python and R to do this but my code was in C++. I came across a M1QN3 algorithm and was very impressed by its performance.</p>

<h2 id="minpack">MINPACK</h2>

<p><a href="http://www.netlib.org/minpack/">MINPACK</a> is a library of FORTRAN subroutines for the solving of systems of nonlinear equations, or the least squares minimization of the residual of a set of linear or nonlinear equations. One of the famous subroutines in this code is <code>lmder</code>.</p>

<div class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="k">subroutine </span><span class="nv">lmder</span><span class="p">(</span><span class="nv">fcn</span><span class="p">,</span><span class="nv">m</span><span class="p">,</span><span class="nv">n</span><span class="p">,</span><span class="nv">x</span><span class="p">,</span><span class="nv">fvec</span><span class="p">,</span><span class="nv">fjac</span><span class="p">,</span><span class="nv">ldfjac</span><span class="p">,</span><span class="nv">ftol</span><span class="p">,</span><span class="nv">xtol</span><span class="p">,</span><span class="nv">gtol</span><span class="p">,</span>
     <span class="o">*</span>                 <span class="nv">maxfev</span><span class="p">,</span><span class="nv">diag</span><span class="p">,</span><span class="nv">mode</span><span class="p">,</span><span class="nv">factor</span><span class="p">,</span><span class="nv">nprint</span><span class="p">,</span><span class="nv">info</span><span class="p">,</span><span class="nv">nfev</span><span class="p">,</span><span class="nv">njev</span><span class="p">,</span>
     <span class="o">*</span>                 <span class="nv">ipvt</span><span class="p">,</span><span class="nv">qtf</span><span class="p">,</span><span class="nv">wa1</span><span class="p">,</span><span class="nv">wa2</span><span class="p">,</span><span class="nv">wa3</span><span class="p">,</span><span class="nv">wa4</span><span class="p">)</span></code></pre></div>

<p>A C/C++ rewrite of the MINPACK is available in <a href="https://github.com/devernay/cminpack">GitHub</a>. This portable and easy to use. Here is an example from <a href="https://raw.githubusercontent.com/devernay/cminpack/master/examples/tlmder_.c">cminpack</a>. Note the definition of <code>__minpack_real__</code> and the use macro <code>__minpack_func__()</code></p>

<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="cm">/*      driver for lmder example. */</span>


<span class="cp">#include &lt;stdio.h&gt;</span>
<span class="cp">#include &lt;math.h&gt;</span>
<span class="cp">#include &lt;assert.h&gt;</span>
<span class="cp">#include &lt;minpack.h&gt;</span>
<span class="cp">#define real __minpack_real__</span>

<span class="kt">void</span> <span class="nf">fcn</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="k">const</span> <span class="n">real</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">real</span> <span class="o">*</span><span class="n">fvec</span><span class="p">,</span> <span class="n">real</span> <span class="o">*</span><span class="n">fjac</span><span class="p">,</span>
     <span class="k">const</span> <span class="kt">int</span> <span class="o">*</span><span class="n">ldfjac</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">iflag</span><span class="p">);</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">m</span><span class="p">,</span> <span class="n">n</span><span class="p">,</span> <span class="n">ldfjac</span><span class="p">,</span> <span class="n">maxfev</span><span class="p">,</span> <span class="n">mode</span><span class="p">,</span> <span class="n">nprint</span><span class="p">,</span> <span class="n">info</span><span class="p">,</span> <span class="n">nfev</span><span class="p">,</span> <span class="n">njev</span><span class="p">;</span>
  <span class="kt">int</span> <span class="n">ipvt</span><span class="p">[</span><span class="mi">3</span><span class="p">];</span>
  <span class="n">real</span> <span class="n">ftol</span><span class="p">,</span> <span class="n">xtol</span><span class="p">,</span> <span class="n">gtol</span><span class="p">,</span> <span class="n">factor</span><span class="p">,</span> <span class="n">fnorm</span><span class="p">;</span>
  <span class="n">real</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">fvec</span><span class="p">[</span><span class="mi">15</span><span class="p">],</span> <span class="n">fjac</span><span class="p">[</span><span class="mi">15</span><span class="o">*</span><span class="mi">3</span><span class="p">],</span> <span class="n">diag</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">qtf</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span>
    <span class="n">wa1</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">wa2</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">wa3</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">wa4</span><span class="p">[</span><span class="mi">15</span><span class="p">];</span>
  <span class="kt">int</span> <span class="n">one</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span>
  <span class="n">real</span> <span class="n">covfac</span><span class="p">;</span>

  <span class="n">m</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>
  <span class="n">n</span> <span class="o">=</span> <span class="mi">3</span><span class="p">;</span>

<span class="cm">/*      the following starting values provide a rough fit. */</span>

  <span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
  <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>
  <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mf">1.</span><span class="p">;</span>

  <span class="n">ldfjac</span> <span class="o">=</span> <span class="mi">15</span><span class="p">;</span>

  <span class="cm">/*      set ftol and xtol to the square root of the machine */</span>
  <span class="cm">/*      and gtol to zero. unless high solutions are */</span>
  <span class="cm">/*      required, these are the recommended settings. */</span>

  <span class="n">ftol</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">__minpack_func__</span><span class="p">(</span><span class="n">dpmpar</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">one</span><span class="p">));</span>
  <span class="n">xtol</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">__minpack_func__</span><span class="p">(</span><span class="n">dpmpar</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">one</span><span class="p">));</span>
  <span class="n">gtol</span> <span class="o">=</span> <span class="mf">0.</span><span class="p">;</span>

  <span class="n">maxfev</span> <span class="o">=</span> <span class="mi">400</span><span class="p">;</span>
  <span class="n">mode</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
  <span class="n">factor</span> <span class="o">=</span> <span class="mf">1.e2</span><span class="p">;</span>
  <span class="n">nprint</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

  <span class="n">__minpack_func__</span><span class="p">(</span><span class="n">lmder</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">fcn</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">fvec</span><span class="p">,</span> <span class="n">fjac</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldfjac</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ftol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">xtol</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">gtol</span><span class="p">,</span>
    <span class="o">&amp;</span><span class="n">maxfev</span><span class="p">,</span> <span class="n">diag</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">mode</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">factor</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nprint</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">info</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">nfev</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">njev</span><span class="p">,</span>
    <span class="n">ipvt</span><span class="p">,</span> <span class="n">qtf</span><span class="p">,</span> <span class="n">wa1</span><span class="p">,</span> <span class="n">wa2</span><span class="p">,</span> <span class="n">wa3</span><span class="p">,</span> <span class="n">wa4</span><span class="p">);</span>
  <span class="n">fnorm</span> <span class="o">=</span> <span class="n">__minpack_func__</span><span class="p">(</span><span class="n">enorm</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">m</span><span class="p">,</span> <span class="n">fvec</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;      final l2 norm of the residuals%15.7g</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">fnorm</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;      number of function evaluations%10i</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">nfev</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;      number of Jacobian evaluations%10i</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">njev</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;      exit parameter                %10i</span><span class="se">\n\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">info</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;      final approximate solution</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s%15.7g&quot;</span><span class="p">,</span> <span class="n">j</span><span class="o">%</span><span class="mi">3</span><span class="o">==</span><span class="mi">1</span><span class="o">?</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">     &quot;</span><span class="o">:</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">x</span><span class="p">[</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]);</span>
  <span class="p">}</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="n">ftol</span> <span class="o">=</span> <span class="n">__minpack_func__</span><span class="p">(</span><span class="n">dpmpar</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">one</span><span class="p">);</span>
  <span class="n">covfac</span> <span class="o">=</span> <span class="n">fnorm</span><span class="o">*</span><span class="n">fnorm</span><span class="o">/</span><span class="p">(</span><span class="n">m</span><span class="o">-</span><span class="n">n</span><span class="p">);</span>
  <span class="n">__minpack_func__</span><span class="p">(</span><span class="n">covar</span><span class="p">)(</span><span class="o">&amp;</span><span class="n">n</span><span class="p">,</span> <span class="n">fjac</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ldfjac</span><span class="p">,</span> <span class="n">ipvt</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">ftol</span><span class="p">,</span> <span class="n">wa1</span><span class="p">);</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;      covariance</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">j</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">j</span><span class="o">&lt;=</span><span class="n">n</span><span class="p">;</span> <span class="n">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">printf</span><span class="p">(</span><span class="s">&quot;%s%15.7g&quot;</span><span class="p">,</span> <span class="n">j</span><span class="o">%</span><span class="mi">3</span><span class="o">==</span><span class="mi">1</span><span class="o">?</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">     &quot;</span><span class="o">:</span><span class="s">&quot;&quot;</span><span class="p">,</span> <span class="p">(</span><span class="kt">double</span><span class="p">)</span><span class="n">fjac</span><span class="p">[(</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span><span class="o">*</span><span class="n">ldfjac</span><span class="o">+</span><span class="n">j</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">covfac</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">}</span>
  <span class="n">printf</span><span class="p">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="nf">fcn</span><span class="p">(</span><span class="k">const</span> <span class="kt">int</span> <span class="o">*</span><span class="n">m</span><span class="p">,</span> <span class="k">const</span> <span class="kt">int</span> <span class="o">*</span><span class="n">n</span><span class="p">,</span> <span class="k">const</span> <span class="n">real</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="n">real</span> <span class="o">*</span><span class="n">fvec</span><span class="p">,</span> <span class="n">real</span> <span class="o">*</span><span class="n">fjac</span><span class="p">,</span>
     <span class="k">const</span> <span class="kt">int</span> <span class="o">*</span><span class="n">ldfjac</span><span class="p">,</span> <span class="kt">int</span> <span class="o">*</span><span class="n">iflag</span><span class="p">)</span>
<span class="p">{</span>

  <span class="cm">/*      subroutine fcn for lmder example. */</span>

  <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>
  <span class="n">real</span> <span class="n">tmp1</span><span class="p">,</span> <span class="n">tmp2</span><span class="p">,</span> <span class="n">tmp3</span><span class="p">,</span> <span class="n">tmp4</span><span class="p">;</span>
  <span class="n">real</span> <span class="n">y</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span><span class="o">=</span><span class="p">{</span><span class="mf">1.4e-1</span><span class="p">,</span> <span class="mf">1.8e-1</span><span class="p">,</span> <span class="mf">2.2e-1</span><span class="p">,</span> <span class="mf">2.5e-1</span><span class="p">,</span> <span class="mf">2.9e-1</span><span class="p">,</span> <span class="mf">3.2e-1</span><span class="p">,</span> <span class="mf">3.5e-1</span><span class="p">,</span>
        <span class="mf">3.9e-1</span><span class="p">,</span> <span class="mf">3.7e-1</span><span class="p">,</span> <span class="mf">5.8e-1</span><span class="p">,</span> <span class="mf">7.3e-1</span><span class="p">,</span> <span class="mf">9.6e-1</span><span class="p">,</span> <span class="mf">1.34</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="mf">4.39</span><span class="p">};</span>
  <span class="n">assert</span><span class="p">(</span><span class="o">*</span><span class="n">m</span> <span class="o">==</span> <span class="mi">15</span> <span class="o">&amp;&amp;</span> <span class="o">*</span><span class="n">n</span> <span class="o">==</span> <span class="mi">3</span><span class="p">);</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">iflag</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/*      insert print statements here when nprint is positive. */</span>
    <span class="cm">/* if the nprint parameter to lmder is positive, the function is</span>
<span class="cm">       called every nprint iterations with iflag=0, so that the</span>
<span class="cm">       function may perform special operations, such as printing</span>
<span class="cm">       residuals. */</span>
    <span class="k">return</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="k">if</span> <span class="p">(</span><span class="o">*</span><span class="n">iflag</span> <span class="o">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/* compute residuals */</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;=</span> <span class="mi">15</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
      <span class="n">tmp1</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
      <span class="n">tmp2</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>
      <span class="n">tmp3</span> <span class="o">=</span> <span class="n">tmp1</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tmp3</span> <span class="o">=</span> <span class="n">tmp2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">fvec</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">tmp1</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">tmp2</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">tmp3</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="cm">/* compute Jacobian */</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="o">=</span><span class="mi">1</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;=</span><span class="mi">15</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
      <span class="n">tmp1</span> <span class="o">=</span> <span class="n">i</span><span class="p">;</span>
      <span class="n">tmp2</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">-</span> <span class="n">i</span><span class="p">;</span>
      <span class="n">tmp3</span> <span class="o">=</span> <span class="n">tmp1</span><span class="p">;</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">i</span> <span class="o">&gt;</span> <span class="mi">8</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">tmp3</span> <span class="o">=</span> <span class="n">tmp2</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="n">tmp4</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">tmp2</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">3</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">tmp3</span><span class="p">);</span> <span class="n">tmp4</span> <span class="o">=</span> <span class="n">tmp4</span><span class="o">*</span><span class="n">tmp4</span><span class="p">;</span>
      <span class="n">fjac</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="o">*</span><span class="n">ldfjac</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.</span><span class="p">;</span>
      <span class="n">fjac</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="o">*</span><span class="n">ldfjac</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tmp1</span><span class="o">*</span><span class="n">tmp2</span><span class="o">/</span><span class="n">tmp4</span><span class="p">;</span>
      <span class="n">fjac</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="o">*</span><span class="n">ldfjac</span><span class="o">*</span><span class="p">(</span><span class="mi">3</span><span class="o">-</span><span class="mi">1</span><span class="p">)]</span> <span class="o">=</span> <span class="n">tmp1</span><span class="o">*</span><span class="n">tmp3</span><span class="o">/</span><span class="n">tmp4</span><span class="p">;</span>
    <span class="p">};</span>
  <span class="p">}</span>
  <span class="k">return</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<h2 id="eigen-library">Eigen library</h2>

<p><a href="http://eigen.tuxfamily.org/index.php?title=Main_Page">Eigen</a> has its own port of MINPACK. However, it is in the unsupported modules and the documentation can be found <a href="http://eigen.tuxfamily.org/dox-devel/unsupported/group__NonLinearOptimization__Module.html">here</a>.  Here is a snippet from of the examples provided by Eigen.</p>

<div class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="k">struct</span> <span class="nl">lmder_functor</span> <span class="p">:</span> <span class="n">Functor</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span>
<span class="p">{</span>
    <span class="n">lmder_functor</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="o">:</span> <span class="n">Functor</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">15</span><span class="p">)</span> <span class="p">{}</span>
    <span class="kt">int</span> <span class="k">operator</span><span class="p">()(</span><span class="k">const</span> <span class="n">VectorXd</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="n">VectorXd</span> <span class="o">&amp;</span><span class="n">fvec</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="kt">double</span> <span class="n">tmp1</span><span class="p">,</span> <span class="n">tmp2</span><span class="p">,</span> <span class="n">tmp3</span><span class="p">;</span>
        <span class="k">static</span> <span class="k">const</span> <span class="kt">double</span> <span class="n">y</span><span class="p">[</span><span class="mi">15</span><span class="p">]</span> <span class="o">=</span> <span class="p">{</span><span class="mf">1.4e-1</span><span class="p">,</span> <span class="mf">1.8e-1</span><span class="p">,</span> <span class="mf">2.2e-1</span><span class="p">,</span> <span class="mf">2.5e-1</span><span class="p">,</span> <span class="mf">2.9e-1</span><span class="p">,</span> <span class="mf">3.2e-1</span><span class="p">,</span> <span class="mf">3.5e-1</span><span class="p">,</span>
            <span class="mf">3.9e-1</span><span class="p">,</span> <span class="mf">3.7e-1</span><span class="p">,</span> <span class="mf">5.8e-1</span><span class="p">,</span> <span class="mf">7.3e-1</span><span class="p">,</span> <span class="mf">9.6e-1</span><span class="p">,</span> <span class="mf">1.34</span><span class="p">,</span> <span class="mf">2.1</span><span class="p">,</span> <span class="mf">4.39</span><span class="p">};</span>

        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">tmp1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">tmp2</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">tmp3</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">8</span><span class="p">)</span><span class="o">?</span> <span class="nl">tmp2</span> <span class="p">:</span> <span class="n">tmp1</span><span class="p">;</span>
            <span class="n">fvec</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">tmp1</span><span class="o">/</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">tmp2</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">tmp3</span><span class="p">));</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">df</span><span class="p">(</span><span class="k">const</span> <span class="n">VectorXd</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">,</span> <span class="n">MatrixXd</span> <span class="o">&amp;</span><span class="n">fjac</span><span class="p">)</span> <span class="k">const</span>
    <span class="p">{</span>
        <span class="kt">double</span> <span class="n">tmp1</span><span class="p">,</span> <span class="n">tmp2</span><span class="p">,</span> <span class="n">tmp3</span><span class="p">,</span> <span class="n">tmp4</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">values</span><span class="p">();</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">tmp1</span> <span class="o">=</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">tmp2</span> <span class="o">=</span> <span class="mi">16</span> <span class="o">-</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
            <span class="n">tmp3</span> <span class="o">=</span> <span class="p">(</span><span class="n">i</span><span class="o">&gt;=</span><span class="mi">8</span><span class="p">)</span><span class="o">?</span> <span class="nl">tmp2</span> <span class="p">:</span> <span class="n">tmp1</span><span class="p">;</span>
            <span class="n">tmp4</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">*</span><span class="n">tmp2</span> <span class="o">+</span> <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">*</span><span class="n">tmp3</span><span class="p">);</span> <span class="n">tmp4</span> <span class="o">=</span> <span class="n">tmp4</span><span class="o">*</span><span class="n">tmp4</span><span class="p">;</span>
            <span class="n">fjac</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">;</span>
            <span class="n">fjac</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="o">=</span> <span class="n">tmp1</span><span class="o">*</span><span class="n">tmp2</span><span class="o">/</span><span class="n">tmp4</span><span class="p">;</span>
            <span class="n">fjac</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span> <span class="o">=</span> <span class="n">tmp1</span><span class="o">*</span><span class="n">tmp3</span><span class="o">/</span><span class="n">tmp4</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">};</span>

<span class="kt">void</span> <span class="nf">testLmder1</span><span class="p">()</span>
<span class="p">{</span>
  <span class="kt">int</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">info</span><span class="p">;</span>

  <span class="n">VectorXd</span> <span class="n">x</span><span class="p">;</span>

  <span class="cm">/* the following starting values provide a rough fit. */</span>
  <span class="n">x</span><span class="p">.</span><span class="n">setConstant</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="mf">1.</span><span class="p">);</span>

  <span class="c1">// do the computation</span>
  <span class="n">lmder_functor</span> <span class="n">functor</span><span class="p">;</span>
  <span class="n">LevenbergMarquardt</span><span class="o">&lt;</span><span class="n">lmder_functor</span><span class="o">&gt;</span> <span class="n">lm</span><span class="p">(</span><span class="n">functor</span><span class="p">);</span>
  <span class="n">info</span> <span class="o">=</span> <span class="n">lm</span><span class="p">.</span><span class="n">lmder1</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>

  <span class="c1">// check return value</span>
  <span class="n">VERIFY_IS_EQUAL</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
  <span class="n">VERIFY_IS_EQUAL</span><span class="p">(</span><span class="n">lm</span><span class="p">.</span><span class="n">nfev</span><span class="p">,</span> <span class="mi">6</span><span class="p">);</span>
  <span class="n">VERIFY_IS_EQUAL</span><span class="p">(</span><span class="n">lm</span><span class="p">.</span><span class="n">njev</span><span class="p">,</span> <span class="mi">5</span><span class="p">);</span>

  <span class="c1">// check norm</span>
  <span class="n">VERIFY_IS_APPROX</span><span class="p">(</span><span class="n">lm</span><span class="p">.</span><span class="n">fvec</span><span class="p">.</span><span class="n">blueNorm</span><span class="p">(),</span> <span class="mf">0.09063596</span><span class="p">);</span>

  <span class="c1">// check x</span>
  <span class="n">VectorXd</span> <span class="n">x_ref</span><span class="p">(</span><span class="n">n</span><span class="p">);</span>
  <span class="n">x_ref</span> <span class="o">&lt;&lt;</span> <span class="mf">0.08241058</span><span class="p">,</span> <span class="mf">1.133037</span><span class="p">,</span> <span class="mf">2.343695</span><span class="p">;</span>
  <span class="n">VERIFY_IS_APPROX</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">x_ref</span><span class="p">);</span>
<span class="p">}</span></code></pre></div>

<h2 id="hlbfgs">HLBFGS</h2>

<p><a href="http://research.microsoft.com/en-us/um/people/yangliu/software/hlbfgs/">HLBFGS</a> is a hybrid L-BFGS(Limited Memory Broyden–Fletcher–Goldfarb–Shanno Method) optimization framework which unifies L-BFGS method, Preconditioned L-BFGS method and Preconditioned Conjugate Gradient method. With different options, HLBFGS also works like gradient-decent method, Newton method and Conjugate-gradient method. The original purpose I wrote this routine is for fast-computing large-scaled Centroidal Voronoi diagram. This is one of my favorite libraries and offers a big set of algorithms, for example, Gradient Decent, Conjugate Gradient, L-BFGS and M1QN3. I am making use of this library in my code and find it very stable. Here is an example that shows the easiness of the API</p>

<div class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cp">#ifdef _DEBUG</span>
<span class="cp">#define _CRTDBG_MAP_ALLOC</span>
<span class="cp">#include &lt;stdlib.h&gt;</span>
<span class="cp">#include &lt;crtdbg.h&gt;</span>
<span class="cp">#endif</span>

<span class="cp">#include &quot;HLBFGS.h&quot;</span>

<span class="cp">#include &quot;Lite_Sparse_Matrix.h&quot;</span>

<span class="cp">#include &lt;iostream&gt;</span>

<span class="n">Lite_Sparse_Matrix</span><span class="o">*</span> <span class="n">m_sparse_matrix</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

<span class="c1">//////////////////////////////////////////////////////////////////////////</span>
<span class="kt">void</span> <span class="nf">evalfunc</span><span class="p">(</span><span class="kt">int</span> <span class="n">N</span><span class="p">,</span> <span class="kt">double</span><span class="o">*</span> <span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span><span class="n">prev_x</span><span class="p">,</span> <span class="kt">double</span><span class="o">*</span> <span class="n">f</span><span class="p">,</span> <span class="kt">double</span><span class="o">*</span> <span class="n">g</span><span class="p">)</span>
<span class="p">{</span>
    <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">+=</span><span class="mi">2</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">double</span> <span class="n">T1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
        <span class="kt">double</span> <span class="n">T2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="o">*</span><span class="n">f</span> <span class="o">+=</span> <span class="n">T1</span><span class="o">*</span><span class="n">T1</span><span class="o">+</span><span class="n">T2</span><span class="o">*</span><span class="n">T2</span><span class="p">;</span>
        <span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>   <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">T2</span><span class="p">;</span>
        <span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">T1</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="c1">//////////////////////////////////////////////////////////////////////////</span>
<span class="kt">void</span> <span class="nf">newiteration</span><span class="p">(</span><span class="kt">int</span> <span class="n">iter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">call_iter</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="kt">double</span><span class="o">*</span> <span class="n">f</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span><span class="n">g</span><span class="p">,</span>  <span class="kt">double</span><span class="o">*</span> <span class="n">gnorm</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">iter</span> <span class="o">&lt;&lt;</span><span class="s">&quot;: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">call_iter</span> <span class="o">&lt;&lt;</span><span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">f</span> <span class="o">&lt;&lt;</span><span class="s">&quot; &quot;</span> <span class="o">&lt;&lt;</span> <span class="o">*</span><span class="n">gnorm</span>  <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//////////////////////////////////////////////////////////////////////////</span>
<span class="kt">void</span> <span class="nf">evalfunc_h</span><span class="p">(</span><span class="kt">int</span> <span class="n">N</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span><span class="n">x</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span><span class="n">prev_x</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span><span class="n">f</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span><span class="n">g</span><span class="p">,</span> <span class="n">HESSIAN_MATRIX</span><span class="o">&amp;</span> <span class="n">hessian</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">//the following code is not optimal if the pattern of hessian matrix is fixed.</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">m_sparse_matrix</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="k">delete</span> <span class="n">m_sparse_matrix</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">m_sparse_matrix</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Lite_Sparse_Matrix</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">N</span><span class="p">,</span> <span class="n">SYM_LOWER</span><span class="p">,</span> <span class="n">CCS</span><span class="p">,</span> <span class="n">FORTRAN_TYPE</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>

    <span class="n">m_sparse_matrix</span><span class="o">-&gt;</span><span class="n">begin_fill_entry</span><span class="p">();</span>

    <span class="k">static</span> <span class="kt">bool</span> <span class="n">first</span> <span class="o">=</span> <span class="nb">true</span><span class="p">;</span>
    <span class="kt">double</span> <span class="o">*</span><span class="n">diag</span> <span class="o">=</span> <span class="n">m_sparse_matrix</span><span class="o">-&gt;</span><span class="n">get_diag</span><span class="p">();</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">first</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="c1">// you need to update f and g</span>
        <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">double</span> <span class="n">tmp</span><span class="p">;</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">+=</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">tmp</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="kt">double</span> <span class="n">T1</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">];</span>
            <span class="kt">double</span> <span class="n">T2</span> <span class="o">=</span> <span class="mi">10</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">tmp</span><span class="p">);</span>
            <span class="o">*</span><span class="n">f</span> <span class="o">+=</span> <span class="n">T1</span><span class="o">*</span><span class="n">T1</span><span class="o">+</span><span class="n">T2</span><span class="o">*</span><span class="n">T2</span><span class="p">;</span>
            <span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span>   <span class="o">=</span> <span class="mi">20</span><span class="o">*</span><span class="n">T2</span><span class="p">;</span>
            <span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">g</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">T1</span><span class="p">);</span>
            <span class="n">diag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">+</span><span class="mi">1200</span><span class="o">*</span><span class="n">tmp</span><span class="o">-</span><span class="mi">400</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
            <span class="n">diag</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
            <span class="n">m_sparse_matrix</span><span class="o">-&gt;</span><span class="n">fill_entry</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">400</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="p">;</span> <span class="n">i</span><span class="o">+=</span><span class="mi">2</span><span class="p">)</span>
        <span class="p">{</span>
            <span class="n">diag</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="mi">2</span><span class="o">+</span><span class="mi">1200</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">-</span><span class="mi">400</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">];</span>
            <span class="n">diag</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="mi">200</span><span class="p">;</span>
            <span class="n">m_sparse_matrix</span><span class="o">-&gt;</span><span class="n">fill_entry</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">400</span><span class="o">*</span><span class="n">x</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">m_sparse_matrix</span><span class="o">-&gt;</span><span class="n">end_fill_entry</span><span class="p">();</span>

    <span class="n">hessian</span><span class="p">.</span><span class="n">set_diag</span><span class="p">(</span><span class="n">m_sparse_matrix</span><span class="o">-&gt;</span><span class="n">get_diag</span><span class="p">());</span>
    <span class="n">hessian</span><span class="p">.</span><span class="n">set_values</span><span class="p">(</span><span class="n">m_sparse_matrix</span><span class="o">-&gt;</span><span class="n">get_values</span><span class="p">());</span>
    <span class="n">hessian</span><span class="p">.</span><span class="n">set_rowind</span><span class="p">(</span><span class="n">m_sparse_matrix</span><span class="o">-&gt;</span><span class="n">get_rowind</span><span class="p">());</span>
    <span class="n">hessian</span><span class="p">.</span><span class="n">set_colptr</span><span class="p">(</span><span class="n">m_sparse_matrix</span><span class="o">-&gt;</span><span class="n">get_colptr</span><span class="p">());</span>
    <span class="n">hessian</span><span class="p">.</span><span class="n">set_nonzeros</span><span class="p">(</span><span class="n">m_sparse_matrix</span><span class="o">-&gt;</span><span class="n">get_nonzero</span><span class="p">());</span>
    <span class="n">first</span> <span class="o">=</span> <span class="nb">false</span><span class="p">;</span>
<span class="p">}</span>
<span class="c1">//////////////////////////////////////////////////////////////////////////</span>
<span class="kt">void</span> <span class="nf">Optimize_by_HLBFGS</span><span class="p">(</span><span class="kt">int</span> <span class="n">N</span><span class="p">,</span> <span class="kt">double</span> <span class="o">*</span><span class="n">init_x</span><span class="p">,</span> <span class="kt">int</span> <span class="n">num_iter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">M</span><span class="p">,</span> <span class="kt">int</span> <span class="n">T</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">with_hessian</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">parameter</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
    <span class="kt">int</span> <span class="n">info</span><span class="p">[</span><span class="mi">20</span><span class="p">];</span>
    <span class="c1">//initialize</span>
    <span class="n">INIT_HLBFGS</span><span class="p">(</span><span class="n">parameter</span><span class="p">,</span> <span class="n">info</span><span class="p">);</span>
    <span class="n">info</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="n">num_iter</span><span class="p">;</span>
    <span class="n">info</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="n">T</span><span class="p">;</span>
    <span class="n">info</span><span class="p">[</span><span class="mi">7</span><span class="p">]</span> <span class="o">=</span> <span class="n">with_hessian</span><span class="o">?</span><span class="mi">1</span><span class="o">:</span><span class="mi">0</span><span class="p">;</span>
    <span class="n">info</span><span class="p">[</span><span class="mi">10</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">info</span><span class="p">[</span><span class="mi">11</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">with_hessian</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">HLBFGS</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">init_x</span><span class="p">,</span> <span class="n">evalfunc</span><span class="p">,</span> <span class="n">evalfunc_h</span><span class="p">,</span> <span class="n">HLBFGS_UPDATE_Hessian</span><span class="p">,</span> <span class="n">newiteration</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">info</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">else</span>
    <span class="p">{</span>
        <span class="n">HLBFGS</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">init_x</span><span class="p">,</span> <span class="n">evalfunc</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">HLBFGS_UPDATE_Hessian</span><span class="p">,</span> <span class="n">newiteration</span><span class="p">,</span> <span class="n">parameter</span><span class="p">,</span> <span class="n">info</span><span class="p">);</span>
    <span class="p">}</span>

<span class="p">}</span>
<span class="c1">//////////////////////////////////////////////////////////////////////////</span>
<span class="kt">void</span> <span class="nf">main</span><span class="p">()</span>
<span class="p">{</span>
<span class="cp">#ifdef _DEBUG</span>
    <span class="n">_CrtSetDbgFlag</span><span class="p">(</span><span class="n">_CRTDBG_ALLOC_MEM_DF</span> <span class="o">|</span> <span class="n">_CRTDBG_LEAK_CHECK_DF</span><span class="p">);</span>
<span class="cp">#endif</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span><span class="p">.</span><span class="n">precision</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">scientific</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">N</span> <span class="o">=</span> <span class="mi">1000</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">vector</span><span class="o">&lt;</span><span class="kt">double</span><span class="o">&gt;</span> <span class="n">x</span><span class="p">(</span><span class="n">N</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">N</span><span class="o">/</span><span class="mi">2</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="p">]</span>   <span class="o">=</span> <span class="o">-</span><span class="mf">1.2</span><span class="p">;</span>
        <span class="n">x</span><span class="p">[</span><span class="mi">2</span><span class="o">*</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span>  <span class="mf">1.0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="kt">int</span> <span class="n">M</span> <span class="o">=</span> <span class="mi">7</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">T</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="c1">//use Hessian</span>
    <span class="c1">// if M = 0, T = 0, it is Newton</span>
    <span class="c1">//Optimize_by_HLBFGS(N, &amp;x[0], 1000, M, T, true);</span>

    <span class="c1">//without Hessian</span>
    <span class="n">Optimize_by_HLBFGS</span><span class="p">(</span><span class="n">N</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1000</span><span class="p">,</span> <span class="n">M</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="nb">false</span><span class="p">);</span>  <span class="c1">// it is LBFGS(M) actually, T is not used</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">m_sparse_matrix</span><span class="p">)</span>
        <span class="k">delete</span> <span class="n">m_sparse_matrix</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<h2 id="m1qn3">M1QN3</h2>

<p>While using HLFBGS I noticed the excellent performance of MIQN3 algorithm. So started looking further and came across the <a href="https://who.rocq.inria.fr/Jean-Charles.Gilbert/modulopt/optimization-routines/m1qn3/m1qn3.html">original fortran version</a>. It is a part of <a href="https://who.rocq.inria.fr/Jean-Charles.Gilbert/modulopt/modulopt.html">MODULOPT</a>, a library for solving optimization problems and testing optimization software. The API in fortran for M1QN3 is shown below</p>

<div class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="k">subroutine </span><span class="nv">m1qn3</span> <span class="p">(</span><span class="nv">simul</span><span class="p">,</span> <span class="nv">prosca</span><span class="p">,</span> <span class="nv">ctonb</span><span class="p">,</span> <span class="nv">ctcab</span><span class="p">,</span> <span class="nv">n</span><span class="p">,</span> <span class="nv">x</span><span class="p">,</span> <span class="nv">f</span><span class="p">,</span> <span class="nv">g</span><span class="p">,</span> <span class="p">&amp;</span>
    <span class="nv">dxmin</span><span class="p">,</span> <span class="nv">df1</span><span class="p">,</span> <span class="nv">epsg</span><span class="p">,</span> <span class="nv">normtype</span><span class="p">,</span> <span class="nv">impres</span><span class="p">,</span> <span class="nv">io</span><span class="p">,</span> <span class="p">&amp;</span>
    <span class="nv">imode</span><span class="p">,</span> <span class="nv">omode</span><span class="p">,</span> <span class="nv">niter</span><span class="p">,</span> <span class="nv">nsim</span><span class="p">,</span> <span class="nv">iz</span><span class="p">,</span> <span class="nv">dz</span><span class="p">,</span> <span class="nv">ndz</span><span class="p">,</span> <span class="p">&amp;</span>
    <span class="nv">reverse</span><span class="p">,</span> <span class="nv">indic</span><span class="p">,</span> <span class="nv">izs</span><span class="p">,</span> <span class="nv">rzs</span><span class="p">,</span> <span class="nv">dzs</span><span class="p">)</span></code></pre></div>

<p>Here is what they say about this software in the website</p>

<blockquote>
  <p>The routine M1QN3 has been designed to minimize functions depending on a very large number of variables (several hundred million is sometimes possible) no subject to constraints. It implements a limited memory quasi-Newton technique (the L-BFGS method of J. Nocedal) with a dynamically updated scalar or diagonal preconditioner. It uses line-search to enforce global convergence; more precisely, the step-size is determined by the Fletcher-Lemaréchal algorithm and realizes the Wolfe conditions.</p>
</blockquote>

<p>I find it true. I have tried it with a problem of 1e6 dimensions and it worked. My problem was unimodal and with minor correlations between parameters. Analytical gradients were available as well.</p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
      <div class="entry-image-index">
        <a href="http://tbs1980.github.io/splines/" title="Spline libraries for scientific computation"><img src="http://tbs1980.github.io/images/abstract-7.jpg" alt="Spline libraries for scientific computation"></a>
      </div><!-- /.entry-image -->
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-03-22T00:00:00+00:00"><a href="http://tbs1980.github.io/splines/">March 22, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="http://tbs1980.github.io/about/" title="About Sreekumar Thaithara Balan">Sreekumar Thaithara Balan</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~1 minute
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://tbs1980.github.io/splines/" rel="bookmark" title="Spline libraries for scientific computation" itemprop="url">Spline libraries for scientific computation</a></h1>
    
  </header>
  <div class="entry-content">
    <p>Splines are extremely useful to represent data when the underlying model is unknown or expensive to compute. I use them as a part of my cosmological calculations. In this post I explore the publicly available codes for computing splines. Here is an example of a noisy sine curve in [0,4pi] and smoothed spline curve obtained with GSL B-splines.</p>

<p><img src="/images/gslSplinePlot.png" alt="sine spline" /></p>

<h2 id="gnu-scientific-library-gsl">Gnu Scientific Library (GSL)</h2>

<p><a href="http://www.gnu.org/software/gsl/">GSL</a> offer B-splines as a part of the library. In c/c++ we can use the functionality by</p>

<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include &lt;gsl/gsl_bspline.h&gt;</span></code></pre></div>

<p>An example program can be found <a href="https://www.gnu.org/software/gsl/manual/html_node/Example-programs-for-B_002dsplines.html#Example-programs-for-B_002dsplines">here</a></p>

<h2 id="eigen-library">Eigen library</h2>

<p><a href="http://eigen.tuxfamily.org/index.php?title=Main_Page">Eigen</a> is known for its excellence in linear algebra. It also offers a large set of unsupported modules. <a href="http://eigen.tuxfamily.org/dox/unsupported/group__Splines__Module.html">Splines</a> is one of them. Below you can find a simple code I found in <a href="">KDE forum</a></p>

<div class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cp">#include &lt;unsupported/Eigen/Splines&gt;</span>

<span class="k">typedef</span> <span class="n">Spline</span><span class="o">&lt;</span><span class="kt">double</span><span class="p">,</span><span class="mi">2</span><span class="o">&gt;</span> <span class="n">Spline2d</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">Spline2d</span><span class="o">::</span><span class="n">PointType</span> <span class="n">PointType</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">Spline2d</span><span class="o">::</span><span class="n">KnotVectorType</span> <span class="n">KnotVectorType</span><span class="p">;</span>
<span class="k">typedef</span> <span class="n">Spline2d</span><span class="o">::</span><span class="n">ControlPointVectorType</span> <span class="n">ControlPointVectorType</span><span class="p">;</span>

<span class="n">ControlPointVectorType</span> <span class="n">points</span> <span class="o">=</span> <span class="n">ControlPointVectorType</span><span class="o">::</span><span class="n">Random</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span><span class="mi">100</span><span class="p">);</span>
<span class="k">const</span> <span class="n">Spline2d</span> <span class="n">spline</span> <span class="o">=</span> <span class="n">SplineFitting</span><span class="o">&lt;</span><span class="n">Spline2d</span><span class="o">&gt;::</span><span class="n">Interpolate</span><span class="p">(</span><span class="n">points</span><span class="p">,</span><span class="mi">3</span><span class="p">);</span>

<span class="n">KnotVectorType</span> <span class="n">chord_lengths</span><span class="p">;</span> <span class="c1">// knot parameters</span>
<span class="n">Eigen</span><span class="o">::</span><span class="n">ChordLengths</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">chord_lengths</span><span class="p">);</span>

<span class="k">for</span> <span class="p">(</span><span class="n">Eigen</span><span class="o">::</span><span class="n">DenseIndex</span> <span class="n">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="n">i</span><span class="o">&lt;</span><span class="n">points</span><span class="p">.</span><span class="n">cols</span><span class="p">();</span> <span class="o">++</span><span class="n">i</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">PointType</span> <span class="n">pt</span> <span class="o">=</span> <span class="n">spline</span><span class="p">(</span> <span class="n">chord_lengths</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="p">);</span>
    <span class="n">PointType</span> <span class="n">ref</span> <span class="o">=</span> <span class="n">points</span><span class="p">.</span><span class="n">col</span><span class="p">(</span><span class="n">i</span><span class="p">);</span>
    <span class="n">VERIFY</span><span class="p">(</span> <span class="p">(</span><span class="n">pt</span> <span class="o">-</span> <span class="n">ref</span><span class="p">).</span><span class="n">matrix</span><span class="p">().</span><span class="n">norm</span><span class="p">()</span> <span class="o">&lt;</span> <span class="mf">1e-14</span> <span class="p">);</span>
<span class="p">}</span></code></pre></div>

<h2 id="einspline-library">Einspline library</h2>

<p><a href="http://einspline.sourceforge.net/">Einspline</a> library offers excellent spline fitting facilities. There are several bases available, for example, linear, logarithmic and general. The code is written in c and runs fast. We can get the 1-D splines by including</p>

<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include &lt;nubspline.h&gt;</span></code></pre></div>

<h2 id="benchmarking-splines">Benchmarking splines</h2>

<p>I needed to see how each of these libraries compare to each other and decided to code up a benchmarking repository in github. It can be found <a href="https://github.com/tbs1980/SplineBenchmarks">here</a></p>

  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
      <div class="entry-image-index">
        <a href="http://tbs1980.github.io/numerical-integration/" title="Open source numerical integration codes"><img src="http://tbs1980.github.io/images/abstract-6.jpg" alt="Open source numerical integration codes"></a>
      </div><!-- /.entry-image -->
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-02-16T00:00:00+00:00"><a href="http://tbs1980.github.io/numerical-integration/">February 16, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="http://tbs1980.github.io/about/" title="About Sreekumar Thaithara Balan">Sreekumar Thaithara Balan</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~5 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://tbs1980.github.io/numerical-integration/" rel="bookmark" title="Open source numerical integration codes" itemprop="url">Open source numerical integration codes</a></h1>
    
  </header>
  <div class="entry-content">
    <p>Numerical integration is one of the widely used computational techniques employed in scientific computation. These method can be traced back to mathematicians of ancient Greece. Availability of stable integration routine depends on what programming language you use. For example in Python there is <code>scipy.integrate</code> and it provides a stable code for many differentness computational problems. In R there is the <code>integrate</code> function for one-diemnstional integral really well. Since I work mainly in c, c++ and fortran I was looking for a publicly available code that can be used with my code. I found that QUADPACK and Quadpack++ is the only stable codes publicly available (correct me if I am wrong). There are numerical integration methods available as a part of the QuantLib and AlgLib. Cuba library offers mutli-dimenstional integration routines.  </p>

<h2 id="quadpack">QUADPACK</h2>

<p><a href="http://www.netlib.org/quadpack/">QUADPACK</a> has been around for a while. Written in fortran it remains as one of most stable and widely used codes. It contains several routines for integrating functions of different characteristics. For example the routine <code>QAG</code> provides a 1D globally adaptive integrator using Gauss-Kronrod quadrature.</p>

<div class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="k">subroutine </span><span class="nv">qag</span><span class="p">(</span><span class="nv">f</span><span class="p">,</span><span class="nv">a</span><span class="p">,</span><span class="nv">b</span><span class="p">,</span><span class="nv">epsabs</span><span class="p">,</span><span class="nv">epsrel</span><span class="p">,</span><span class="nv">key</span><span class="p">,</span><span class="k">result</span><span class="p">,</span><span class="nv">abserr</span><span class="p">,</span><span class="nv">neval</span><span class="p">,</span><span class="nv">ier</span><span class="p">,</span><span class="nv">limit</span><span class="p">,</span><span class="nv">lenw</span><span class="p">,</span><span class="nv">last</span><span class="p">,</span><span class="nv">iwork</span><span class="p">,</span><span class="nv">work</span><span class="p">)</span></code></pre></div>

<h2 id="gsl">GSL</h2>

<p><a href="http://www.gnu.org/software/gsl/">GSL</a> has numerical integration module. It provides most of algorithms in QUADPACK. API is straightforward. The example below is from <a href="https://www.gnu.org/software/gsl/manual/html_node/Numerical-integration-examples.html#Numerical-integration-examples">GSL</a></p>

<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include &lt;stdio.h&gt;</span>
<span class="cp">#include &lt;math.h&gt;</span>
<span class="cp">#include &lt;gsl/gsl_integration.h&gt;</span>

<span class="kt">double</span> <span class="nf">f</span> <span class="p">(</span><span class="kt">double</span> <span class="n">x</span><span class="p">,</span> <span class="kt">void</span> <span class="o">*</span> <span class="n">params</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">double</span> <span class="n">alpha</span> <span class="o">=</span> <span class="o">*</span><span class="p">(</span><span class="kt">double</span> <span class="o">*</span><span class="p">)</span> <span class="n">params</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">f</span> <span class="o">=</span> <span class="n">log</span><span class="p">(</span><span class="n">alpha</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="o">/</span> <span class="n">sqrt</span><span class="p">(</span><span class="n">x</span><span class="p">);</span>
    <span class="k">return</span> <span class="n">f</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">gsl_integration_workspace</span> <span class="o">*</span> <span class="n">w</span>
        <span class="o">=</span> <span class="n">gsl_integration_workspace_alloc</span> <span class="p">(</span><span class="mi">1000</span><span class="p">);</span>

    <span class="kt">double</span> <span class="n">result</span><span class="p">,</span> <span class="n">error</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">expected</span> <span class="o">=</span> <span class="o">-</span><span class="mf">4.0</span><span class="p">;</span>
    <span class="kt">double</span> <span class="n">alpha</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">;</span>

    <span class="n">gsl_function</span> <span class="n">F</span><span class="p">;</span>
    <span class="n">F</span><span class="p">.</span><span class="n">function</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">f</span><span class="p">;</span>
    <span class="n">F</span><span class="p">.</span><span class="n">params</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">alpha</span><span class="p">;</span>

    <span class="n">gsl_integration_qags</span> <span class="p">(</span><span class="o">&amp;</span><span class="n">F</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mf">1e-7</span><span class="p">,</span> <span class="mi">1000</span><span class="p">,</span>
        <span class="n">w</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">result</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">error</span><span class="p">);</span>

    <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;result          = % .18f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">);</span>
    <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;exact result    = % .18f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">expected</span><span class="p">);</span>
    <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;estimated error = % .18f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">error</span><span class="p">);</span>
    <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;actual error    = % .18f</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">result</span> <span class="o">-</span> <span class="n">expected</span><span class="p">);</span>
    <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;intervals =  %d</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">w</span><span class="o">-&gt;</span><span class="n">size</span><span class="p">);</span>

    <span class="n">gsl_integration_workspace_free</span> <span class="p">(</span><span class="n">w</span><span class="p">);</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>

<h2 id="quadpack-1">quadpack++</h2>

<p><a href="http://quadpackpp.sourceforge.net/index.html">quadpack++</a> implements adaptive quadrature routines from the GNU Scientific Library for an arbitrary floating-point type using C++ templates. The only requirement is that standard arithmetic operators, including mixed arithmetic with standard types such as “int”, be overloaded for the floating-point type. The core routines are implemented in header files, requiring nothing to be built or linked against. The library is intended for use with multiple-precision calculations. One package supporting this is MPFR, whose website has links to wrappers that define a multiple-precision floating-point type as a C++ class. This last point is <em>extremely</em> significant as both QUADPACK and GSL read the weights from a table and can only do certain predefined rules. quadpack++ implements codes to compute the weights for any arbitrary rule! Below is an example of what it can do</p>

<div class="highlight"><pre><code class="language-c--" data-lang="c++"><span class="cp">#include &lt;cmath&gt;</span>
<span class="cp">#include &lt;cstdlib&gt;</span>
<span class="cp">#include &lt;iostream&gt;</span>
<span class="cp">#include &quot;workspace.hpp&quot;</span>

<span class="k">typedef</span> <span class="kt">double</span> <span class="n">Real</span><span class="p">;</span>

<span class="cp">#define ABS(x) (((x) &lt; Real(0)) ? -(x) : (x))</span>

<span class="n">Real</span> <span class="nf">integrand</span><span class="p">(</span><span class="n">Real</span> <span class="n">x</span><span class="p">,</span> <span class="n">Real</span><span class="o">*</span> <span class="n">alpha</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">pow</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="o">*</span><span class="n">alpha</span><span class="p">)</span> <span class="o">*</span> <span class="n">log</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">x</span><span class="p">);</span>
<span class="p">}</span>

<span class="n">Real</span> <span class="nf">exact</span><span class="p">(</span><span class="n">Real</span> <span class="n">alpha</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">pow</span><span class="p">(</span><span class="n">alpha</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">2</span><span class="p">);</span>
<span class="p">}</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span><span class="o">**</span> <span class="n">argv</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">size_t</span> <span class="n">limit</span> <span class="o">=</span> <span class="mi">128</span><span class="p">;</span>
    <span class="kt">size_t</span> <span class="n">m_deg</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span> <span class="c1">// sets (2m+1)-point Gauss-Kronrod</span>

    <span class="n">Workspace</span><span class="o">&lt;</span><span class="n">Real</span><span class="o">&gt;</span> <span class="n">Work</span><span class="p">(</span><span class="n">limit</span><span class="p">,</span> <span class="n">m_deg</span><span class="p">);</span>

    <span class="c1">// Set parameters and function class...</span>
    <span class="n">Real</span> <span class="n">alpha</span> <span class="o">=</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">?</span> <span class="n">Real</span><span class="p">(</span><span class="n">atof</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span> <span class="o">:</span> <span class="n">Real</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;# alpha : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">alpha</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="n">Function</span><span class="o">&lt;</span><span class="n">Real</span><span class="p">,</span> <span class="n">Real</span><span class="o">&gt;</span> <span class="n">F</span><span class="p">(</span><span class="n">integrand</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">alpha</span><span class="p">);</span>

    <span class="c1">// Set default quadrature tolerance from machine epsilon...</span>
    <span class="n">Real</span> <span class="n">epsabs</span> <span class="o">=</span>  <span class="n">Work</span><span class="p">.</span><span class="n">get_eps</span><span class="p">()</span> <span class="o">*</span> <span class="mf">1e2</span><span class="p">;</span>
    <span class="n">Real</span> <span class="n">epsrel</span> <span class="o">=</span> <span class="n">Real</span><span class="p">(</span><span class="mi">0</span><span class="p">);</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;# epsabs : &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">epsabs</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">status</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="n">Real</span> <span class="n">result</span><span class="p">,</span> <span class="n">abserr</span><span class="p">;</span>

    <span class="n">try</span> <span class="p">{</span>
        <span class="n">status</span> <span class="o">=</span> <span class="n">Work</span><span class="p">.</span><span class="n">qag</span><span class="p">(</span><span class="n">F</span><span class="p">,</span> <span class="n">Real</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="n">Real</span><span class="p">(</span><span class="mi">1</span><span class="p">),</span> <span class="n">epsabs</span><span class="p">,</span> <span class="n">epsrel</span><span class="p">,</span> <span class="n">result</span><span class="p">,</span> <span class="n">abserr</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">catch</span> <span class="p">(</span><span class="k">const</span> <span class="kt">char</span><span class="o">*</span> <span class="n">reason</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">std</span><span class="o">::</span><span class="n">cerr</span> <span class="o">&lt;&lt;</span> <span class="n">reason</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>
        <span class="k">return</span> <span class="n">status</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;result: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">result</span><span class="p">;</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="s">&quot; error: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">ABS</span><span class="p">(</span><span class="n">result</span> <span class="o">-</span> <span class="n">exact</span><span class="p">(</span><span class="n">alpha</span><span class="p">));</span>
    <span class="n">std</span><span class="o">::</span><span class="n">cout</span> <span class="o">&lt;&lt;</span> <span class="n">std</span><span class="o">::</span><span class="n">endl</span><span class="p">;</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span></code></pre></div>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->

<article class="hentry">
  <header>
    
      <div class="entry-image-index">
        <a href="http://tbs1980.github.io/spherical-harmonics/" title="Open source spherical harmonics codes"><img src="http://tbs1980.github.io/images/abstract-3.jpg" alt="Open source spherical harmonics codes"></a>
      </div><!-- /.entry-image -->
    
    <div class="entry-meta">
      <span class="entry-date date published updated"><time datetime="2014-01-05T00:00:00+00:00"><a href="http://tbs1980.github.io/spherical-harmonics/">January 05, 2014</a></time></span><span class="author vcard"><span class="fn"><a href="http://tbs1980.github.io/about/" title="About Sreekumar Thaithara Balan">Sreekumar Thaithara Balan</a></span></span>
      
      <span class="entry-reading-time">
        <i class="fa fa-clock-o"></i>
        
        Reading time ~3 minutes
      </span><!-- /.entry-reading-time -->
      
    </div><!-- /.entry-meta -->
    
      <h1 class="entry-title"><a href="http://tbs1980.github.io/spherical-harmonics/" rel="bookmark" title="Open source spherical harmonics codes" itemprop="url">Open source spherical harmonics codes</a></h1>
    
  </header>
  <div class="entry-content">
    <p>I deal with data on the (shperical) sky every day and one of the easiest way of computing statistics of the data is to reduce them into a set of power spectra. This technique relies on the availability of fast accurate Spherical Harmonic Transforms (SHT). Their applications range from the analysis of geographical and atmospherical data to cosmological surveys. Here is a small list of SHT codes that I tested as a part of my data analysis pipeline.</p>

<h2 id="libsharp">LibSHARP</h2>

<p><a href="https://github.com/dagss/libsharp">LibSHARP</a> is written in c99 with OpenMP and SSE2/AVX. There is also MPI support. It is used as a backend for the widely used <a href="http://healpix.sourceforge.net/">HEALPix</a> library. More information can be found in <a href="http://arxiv.org/abs/1303.4945">ArXiv</a>. It supports many different grid-geometries such as HEALPix, Gauss-Legendre, Fejer and Clenshaw-Curtis. Both scalar and vector transforms are supported. Note that this library is the successor to the <a href="http://sourceforge.net/projects/libpsht/">libpsht</a> library.</p>

<p>Most of the functionality can be loaded by three header files as shown below.</p>

<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include &lt;sharp_lowlevel.h&gt;</span>
<span class="cp">#include &lt;sharp_almhelpers.h&gt;</span>
<span class="cp">#include &lt;sharp_geomhelpers.h&gt;</span></code></pre></div>

<p>The helpers are useful in creating grids on the sky. For example a Gauss-Legendre grid can be created using the helper function.</p>

<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">sharp_make_gauss_geom_info</span> <span class="p">(</span><span class="kt">int</span> <span class="n">nrings</span><span class="p">,</span> <span class="kt">int</span> <span class="n">nphi</span><span class="p">,</span> <span class="kt">double</span> <span class="n">phi0</span><span class="p">,</span>
  <span class="kt">int</span> <span class="n">stride_lon</span><span class="p">,</span> <span class="kt">int</span> <span class="n">stride_lat</span><span class="p">,</span> <span class="n">sharp_geom_info</span> <span class="o">**</span><span class="n">geom_info</span><span class="p">);</span></code></pre></div>

<h2 id="shtns">SHTns</h2>

<p>SHTns is a high performance library for Spherical Harmonic Transform written in c. The spatial data can be stored in latitude-major or longitude-major order arrays. More details and benchmarks can be found in <a href="http://arxiv.org/abs/1202.6522">ArXiv</a>. The code is parallelized by OpenMP. The main dependency is <a href="http://www.fftw.org/">FFTW</a>. API can be load by</p>

<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="cp">#include &lt;shtns.h&gt;</span></code></pre></div>

<p>The library interface is extremely light, for example, the synthesis can be called by</p>

<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">SH_to_spat</span> <span class="p">(</span><span class="n">shtns_cfg</span> <span class="n">shtns</span><span class="p">,</span><span class="n">cplx</span> <span class="o">*</span> <span class="n">Qlm</span><span class="p">,</span><span class="kt">double</span> <span class="o">*</span> <span class="n">Vr</span> <span class="p">);</span></code></pre></div>

<h2 id="shtools">SHTOOLS</h2>

<p><a href="https://github.com/SHTOOLS/SHTOOLS/">SHTOOLS</a> is an archive of Fortran 95 and Python software that can be used to perform spherical harmonic transforms and reconstructions, rotations of data expressed in spherical harmonics, and multitaper spectral analyses on the sphere. There is a good amount of documentation <a href="http://shtools.ipgp.fr/www/documentation.html">here</a>. API is in fortran is straightforward, for example a synthesis  can be performed by</p>

<div class="highlight"><pre><code class="language-fortran" data-lang="fortran"><span class="k">call </span><span class="nv">MakeGridGLQ</span> <span class="p">(</span><span class="nv">gridglq</span><span class="p">,</span> <span class="nv">cilm</span><span class="p">,</span> <span class="nv">lmax</span><span class="p">,</span> <span class="nv">plx</span><span class="p">,</span> <span class="nv">zero</span><span class="p">,</span> <span class="nv">norm</span><span class="p">,</span> <span class="nv">csphase</span><span class="p">,</span> <span class="nv">lmax_calc</span><span class="p">)</span></code></pre></div>

<p>The above code will create a 2D map from a set of spherical harmonic coefficients sampled on the Gauss-Legendre quadrature nodes.</p>

<h2 id="s2hat">S2HAT</h2>

<p>S2HAT is derived from HEALPIx package but since v2.5 it is an independent library. The main features include memory scalability, linear speed-up, memory and load-balance optimization and applicability to any iso-latitude pixelization. Both scalar and vector transforms are supported. What is fascinating about this code is that it has a CUDA version. An example CUDA synthesis API is shown below</p>

<div class="highlight"><pre><code class="language-c" data-lang="c"><span class="kt">void</span> <span class="nf">s2hat_alm2map_cuda</span> <span class="p">(</span>
    <span class="kt">int</span> <span class="n">plms</span><span class="p">,</span> <span class="c1">// no use</span>
    <span class="n">s2hat_pixeltype</span> <span class="n">pixelization</span><span class="p">,</span>
    <span class="n">s2hat_scandef</span> <span class="n">scan</span><span class="p">,</span>
    <span class="kt">int</span> <span class="n">nlmax</span><span class="p">,</span>
    <span class="kt">int</span> <span class="n">nmmax</span><span class="p">,</span>
    <span class="kt">int</span> <span class="n">nmvals</span><span class="p">,</span>
    <span class="kt">int</span><span class="o">*</span> <span class="n">mvals</span><span class="p">,</span>
    <span class="kt">int</span> <span class="n">nmaps</span><span class="p">,</span> <span class="c1">// no use</span>
    <span class="kt">int</span> <span class="n">nstokes</span><span class="p">,</span> <span class="c1">// no use</span>
    <span class="kt">int</span> <span class="n">first_ring</span><span class="p">,</span>
    <span class="kt">int</span> <span class="n">last_ring</span><span class="p">,</span>
    <span class="kt">int</span> <span class="n">map_size</span><span class="p">,</span>
    <span class="kt">double</span> <span class="o">*</span><span class="n">local_map</span><span class="p">,</span>
    <span class="kt">int</span> <span class="n">lda</span><span class="p">,</span>
    <span class="n">s2hat_dcomplex</span> <span class="o">*</span><span class="n">local_alm</span><span class="p">,</span>
    <span class="kt">int</span> <span class="n">nplm</span><span class="p">,</span> <span class="c1">// no use</span>
    <span class="kt">double</span><span class="o">*</span> <span class="n">local_plm</span><span class="p">,</span> <span class="c1">// no use</span>
    <span class="kt">int</span> <span class="n">numprocs</span><span class="p">,</span>
    <span class="kt">int</span> <span class="n">myid</span><span class="p">,</span>
    <span class="n">MPI_Comm</span> <span class="n">comm</span><span class="p">);</span></code></pre></div>


  </div><!-- /.entry-content -->
</article><!-- /.hentry -->


<div class="pagination">
  
    
      <a href="http://tbs1980.github.io/page3" class="btn">Previous</a>
    
  
  <ul class="inline-list">
    <li>
      
        <a href="http://tbs1980.github.io">1</a>
      
    </li>
    
      <li>
        
          <a href="http://tbs1980.github.io/page2">2</a>
        
      </li>
    
      <li>
        
          <a href="http://tbs1980.github.io/page3">3</a>
        
      </li>
    
      <li>
        
          <span class="current-page">4</span>
        
      </li>
    
  </ul>
  
    Next
  
</div><!-- /.pagination -->
</div><!-- /#main -->

<div class="footer-wrapper">
  <footer role="contentinfo">
    <span>&copy; 2015 Sreekumar Thaithara Balan. Powered by <a href="http://jekyllrb.com" rel="nofollow">Jekyll</a> using the <a href="https://mademistakes.com/work/hpstr-jekyll-theme/" rel="nofollow">HPSTR Theme</a>.</span>
  </footer>
</div><!-- /.footer-wrapper -->

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
<script>window.jQuery || document.write('<script src="http://tbs1980.github.io/assets/js/vendor/jquery-1.9.1.min.js"><\/script>')</script>
<script src="http://tbs1980.github.io/assets/js/scripts.min.js"></script>

<script type="text/javascript"
    src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>




          

</body>
</html>